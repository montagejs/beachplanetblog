montageDefine("bfd16e7","ui/component",{dependencies:["montage","core/target","core/bindings","core/template","core/document-resources","core/gate","core/promise","core/logger","core/event/event-manager","collections/set","core/application"],factory:function(e,t){var n=e("montage").Montage,i=e("core/target").Target,r=e("core/bindings").Bindings,a=e("core/template").Template,o=e("core/document-resources").DocumentResources,s=e("core/gate").Gate,l=e("core/promise").Promise,u=e("core/logger").logger("component"),c=e("core/logger").logger("Drawing performance"),h=e("core/logger").logger("drawing"),d=e("core/event/event-manager").defaultEventManager,p=e("collections/set"),m=t.Component=i.specialize({DOM_ARG_ATTRIBUTE:{value:"data-arg"},constructor:{value:function m(){this.super(),this._isComponentExpanded=!1,this._isTemplateLoaded=!1,this._isTemplateInstantiated=!1,this._isComponentTreeLoaded=!1}},delegate:{value:null},templateObjects:{serializable:!1,value:null},_nextTarget:{value:null},nextTarget:{get:function(){return this._nextTarget||this.parentComponent},set:function(e){this._nextTarget=e}},_ownerDocumentPart:{value:null},_templateDocumentPart:{value:null},_domArguments:{value:null},_dispatchActionEvent:{value:function(){this.dispatchEvent(this.createActionEvent())},enumerable:!1},createActionEvent:{value:function(){var e=document.createEvent("CustomEvent");return e.initCustomEvent("action",!0,!0,null),e}},canDrawGate:{get:function(){return this._canDrawGate||(this._canDrawGate=(new s).initWithDelegate(this),this._canDrawGate.setField("componentTreeLoaded",!1)),this._canDrawGate},enumerable:!1},_blockDrawGate:{value:null},blockDrawGate:{enumerable:!1,get:function(){return this._blockDrawGate||(this._blockDrawGate=(new s).initWithDelegate(this),this._blockDrawGate.setField("element",!1),this._blockDrawGate.setField("drawRequested",!1)),this._blockDrawGate}},_firstDraw:{enumerable:!1,value:!0},_completedFirstDraw:{enumerable:!1,value:!1},originalElement:{value:null},_element:{enumerable:!1,value:null},element:{get:function(){return this._element},set:function(e){if(null==e)return console.warn("Tried to set element of ",this," to ",e),void 0;if(this.isDeserializing)this.eventManager.registerEventHandlerForElement(this,e),this._isTemplateInstantiated?this._templateElement||(this._templateElement=e):(this._element=e,!this.blockDrawGate.value&&this._element&&this.blockDrawGate.setField("element",!0));else{if(!this._firstDraw)return console.error("Cannot change element of ",this," after it has been set"),void 0;this.eventManager.registerEventHandlerForElement(this,e),this._element=e,!this.blockDrawGate.value&&this._element&&this.blockDrawGate.setField("element",!0)}this._initializeClassListFromElement(e)}},getElementId:{value:function(){var e=this._element;return e?e.getAttribute("data-montage-id"):void 0}},_initDomArguments:{value:function(){var e,t,n,i={},r=this.element;e=r.querySelectorAll("*["+this.DOM_ARG_ATTRIBUTE+"]");e:for(var a,o=0;a=e[o];o++){for(n=a;(n=n.parentNode)!==r;)if(n.component)continue e;this._findAndDetachComponents(a),a.parentNode.removeChild(a),t=a.getAttribute(this.DOM_ARG_ATTRIBUTE),a.removeAttribute(this.DOM_ARG_ATTRIBUTE),i[t]=a}this._domArguments=i}},getDomArgumentNames:{value:function(){return Object.keys(this._domArguments)}},extractDomArgument:{value:function(e){var t;return t=this._domArguments[e],delete this._domArguments[e],t}},_getDomArgument:{value:function(e,t){var n,i,r,a,o;n=e.querySelectorAll("*["+this.DOM_ARG_ATTRIBUTE+"='"+t+"']");e:for(var s,l=0;s=n[l];l++){for(i=s;(i=i.parentNode)!==e;)if(r=this._template.getElementId(i),r&&(a=this._template.getSerialization(),o=a.getSerializationLabelsWithElements(r),o.length>0))continue e;return s}}},getTemplateParameterArgument:{value:function(e,t){var n,i,r;return n=e.getElementById(this.getElementId()),"*"===t?(i=e.document.createRange(),i.selectNodeContents(n),r=i.cloneContents()):(r=this._getDomArgument(n,t).cloneNode(!0),r.removeAttribute(this.DOM_ARG_ATTRIBUTE)),r}},setElementWithParentComponent:{value:function(e,t){this._alternateParentComponent=t,this.element!==e&&(this.element=e)}},application:{enumerable:!1,get:function(){return e("core/application").application}},eventManager:{enumerable:!1,get:function(){return d}},rootComponent:{enumerable:!1,get:function(){return v}},elementControllerFromEvent:{enumerable:!1,value:function(e,t){return t}},_alternateParentComponent:{value:null},__parentComponent:{value:null},_parentComponent:{set:function(e){this.__parentComponent=e,this.dispatchOwnPropertyChange("parentComponent",e)},get:function(){return this.__parentComponent}},parentComponent:{enumerable:!1,get:function(){return this._parentComponent}},findParentComponent:{value:function(){var e,t=this.element,n=this.eventManager;if(t){for(;null!=(e=t.parentNode)&&null==n.eventHandlerForElement(e);)t=e;return e?n.eventHandlerForElement(e):this._alternateParentComponent}}},querySelectorComponent:{value:function(e){if("string"!=typeof e)throw"querySelectorComponent: Selector needs to be a string.";var t=e.match(/^\s*(?:@([^>\s]+))?(?:\s*(>)?\s*@([^>\s]+)(.*))?$/);if(!t)throw'querySelectorComponent: Syntax error "'+e+'"';var i,r,a,o=this.childComponents,s=t[1],l=(t[2]||" ",t[3]),u=t[4];if(s)for(u=l?"@"+l+u:"",r=0,a;a=o[r];r++){if(s===n.getInfoForObject(a).label)return u?a.querySelectorComponent(u):a;if(i=a.querySelectorComponent(e))return i}else for(r=0,a;a=o[r];r++)if(l===n.getInfoForObject(a).label)return u?a.querySelectorComponent(u):a;return null}},querySelectorAllComponent:{value:function(e,t){if("string"!=typeof e)throw"querySelectorComponent: Selector needs to be a string.";var i=e.match(/^\s*(?:@([^>\s]+))?(?:\s*(>)?\s*@([^>\s]+)(.*))?$/);if(!i)throw'querySelectorComponent: Syntax error "'+e+'"';var r,a,o=this.childComponents,s=i[1],l=(i[2]||" ",i[3]),u=i[4],c=[];if(s)for(u=l?"@"+l+u:"",r=0,a;a=o[r];r++)s!==n.getInfoForObject(a).label||t&&t!==a.ownerComponent?c=c.concat(a.querySelectorAllComponent(e,t)):u?c=c.concat(a.querySelectorAllComponent(u)):c.push(a);else for(r=0,a;a=o[r];r++)l!==n.getInfoForObject(a).label||t&&t!==a.ownerComponent||(u?c=c.concat(a.querySelectorAllComponent(u,t)):c.push(a));return c}},template:{enumerable:!1,value:null},hasTemplate:{enumerable:!1,value:!0},_templateModuleId:{serializable:!1,value:null},_template:{value:null},_treeLevel:{value:0},_addChildComponent:{value:function(e){return this.addChildComponent(e)}},addChildComponent:{value:function(e){-1===this.childComponents.indexOf(e)&&(this.childComponents.push(e),e._prepareForEnterDocument(),e._parentComponent=this,e.needsDraw&&e._addToParentsDrawList())}},attachToParentComponent:{value:function(){this.detachFromParentComponent(),this._parentComponent=null;var e,t,n=this.findParentComponent();if(n){e=n.childComponents;for(var i=0;t=e[i];i++){var r=t.findParentComponent();r===this&&(n.removeChildComponent(t),r.addChildComponent(t))}n.addChildComponent(this)}}},detachFromParentComponent:{value:function(){var e=this.parentComponent;e&&e.removeChildComponent(this)}},removeChildComponent:{value:function(e){var t=this.childComponents,n=t.indexOf(e);n>-1&&(e._exitDocument(),t.splice(n,1),e._parentComponent=null,e._alternateParentComponent=null,e._addedToDrawList&&(e._addedToDrawList=!1,n=this._drawList.indexOf(e),this._drawList.splice(n,1)),this.rootComponent.removeFromCannotDrawList(e))}},childComponents:{enumerable:!1,distinct:!0,value:[]},_needsEnterDocument:{value:!1},_inDocument:{value:!1},__exitDocument:{value:function(){this._inDocument&&"function"==typeof this.exitDocument&&(this.exitDocument(),this._inDocument=!1)}},_exitDocument:{value:function(){var e;this._needsEnterDocument?this._needsEnterDocument=!1:(e=function(t){for(var n,i=t.childComponents,r=0;n=i[r];r++)n._isComponentExpanded&&e(n);t._inDocument&&t.__exitDocument()},e(this))}},exitDocument:{value:function(){this.isActiveTarget&&(d.activeTarget=this.nextTarget)}},_prepareForEnterDocument:{value:function(){this._firstDraw?this._needsEnterDocument=!0:(this.needsDraw=!0,this.traverseComponentTree(function(e){return e._needsEnterDocument?!1:(e._needsEnterDocument=!0,e.needsDraw=!0,void 0)}))}},ownerComponent:{enumerable:!1,value:null},components:{enumerable:!1,value:{}},_isComponentExpanded:{enumerable:!1,value:null},_isTemplateLoaded:{enumerable:!1,value:null},_isTemplateInstantiated:{enumerable:!1,value:null},cleanupDeletedComponentTree:{value:function(e){e&&r.cancelBindings(this),this.needsDraw=!1,this.traverseComponentTree(function(t){e&&r.cancelBindings(t),t.needsDraw=!1})}},_newDomContent:{enumerable:!1,value:null},domContent:{serializable:!1,get:function(){return this._element?Array.prototype.slice.call(this._element.childNodes,0):null},set:function(e){var t,n,i,r=[];for(this._newDomContent=e,this.needsDraw=!0,null===this._newDomContent&&(this._shouldClearDomContentOnNextDraw=!0),"function"==typeof this.contentWillChange&&this.contentWillChange(e),t=this.childComponents,n=0,i;i=t[n];n++)i.detachFromParentComponent();if(e instanceof Element)this._findAndDetachComponents(e,r);else if(e&&e[0])for(n=0;e.length>n;n++)this._findAndDetachComponents(e[n],r);for(n=0,i;i=r[n];n++)this.addChildComponent(i)}},_shouldClearDomContentOnNextDraw:{value:!1},_findAndDetachComponents:{value:function(e,t){var n,i=e.component;if(t||(t=[]),i)i.detachFromParentComponent(),t.push(i);else{n=e.children||e.childNodes;for(var r,a=0;r=n[a];a++)this._findAndDetachComponents(r,t)}return t}},clonesChildComponents:{writable:!1,value:!1},_innerTemplate:{value:null},innerTemplate:{serializable:!1,get:function(){var e,t,n,i,r,a,o,s=this._innerTemplate;if(!s&&(e=this._ownerDocumentPart)){t=e.template,n=this.getElementId(),s=t.createTemplateFromElementContents(n),i=s.getSerialization(),r=i.getExternalObjectLabels(),a=e.objects,o=Object.create(null);for(var l,u=0;l=r[u];u++)o[l]=a[l];s.setInstances(o),this._innerTemplate=s}return s},set:function(e){this._innerTemplate=e}},canDraw:{value:function(){return this._canDraw}},_canDraw:{get:function(){return!this._canDrawGate||this._canDrawGate.value},set:function(e){v.componentCanDraw(this,e)},enumerable:!1},_prepareCanDraw:{enumerable:!1,value:function(){this._isComponentTreeLoaded||this.loadComponentTree().done()}},_isComponentTreeLoaded:{value:null},shouldLoadComponentTree:{value:!0},_loadComponentTreeDeferred:{value:null},loadComponentTree:{value:function(){var e=this,t=this.canDrawGate,n=this._loadComponentTreeDeferred;return n||(n=l.defer(),this._loadComponentTreeDeferred=n,t.setField("componentTreeLoaded",!1),(this.needsDraw||this.hasTemplate)&&(this._canDraw=!1),this.expandComponent().then(function(){if(e.hasTemplate||e.shouldLoadComponentTree){for(var t,n=[],i=e.childComponents,r=0;t=i[r];r++)n.push(t.loadComponentTree());return l.all(n)}}).then(function(){e._isComponentTreeLoaded=!0,e._needsEnterDocument&&(e.needsDraw=!0),t.setField("componentTreeLoaded",!0),n.resolve()},n.reject).done()),n.promise}},traverseComponentTree:{value:function(e,t){function n(){var n,r,a=i.childComponents;if(e&&e(i)===!1)return t&&t(),void 0;if(0===(r=a.length))return t&&t(),void 0;for(var o=function(){0===--r&&t&&t()},s=0;n=a[s];s++)n.traverseComponentTree(e,o)}var i=this;this._isComponentExpanded?n():t&&t()}},_expandComponentDeferred:{value:null},expandComponent:{value:function(){var e=this,t=this._expandComponentDeferred;return t||(t=l.defer(),this._expandComponentDeferred=t,this.hasTemplate?this._instantiateTemplate().then(function(){e._isComponentExpanded=!0,e._addTemplateStyles(),e.needsDraw=!0,t.resolve()},t.reject):(this._isComponentExpanded=!0,t.resolve())),t.promise}},_templateObjectDescriptor:{value:{enumerable:!0,configurable:!0}},_setupTemplateObjects:{value:function(e){var t=this._templateObjectDescriptor,n=Object.create(null);for(var i in e){var r=e[i];"object"==typeof r&&null!=r&&(m.prototype.isPrototypeOf(r)&&r!==this&&r.parentComponent!==this?(t.get=this._makeTemplateObjectGetter(this,i,r),Object.defineProperty(n,i,t)):n[i]=r)}this.templateObjects=n}},_makeTemplateObjectGetter:{value:function(e,t,n){var i,r,a,o="@"+t;return function(){if(i)return e.querySelectorAllComponent(o,e);if(r=e.querySelectorAllComponent(o,e),1===r.length)for(a=r[0];a=a.parentComponent;){if(a===e)return Object.defineProperty(this,t,{value:r[0]}),r[0];if(a.clonesChildComponents)break}else if(0===r.length)return n;return i=!0,r}}},_instantiateTemplate:{value:function(){var e=this;return this._loadTemplate().then(function(t){if(!e._element)return console.error("Cannot instantiate template without an element.",e),l.reject(Error("Cannot instantiate template without an element.",e));var n=e.templateObjects,i=e._element.ownerDocument;return n||(n=Object.create(null)),n.owner=e,e._isTemplateInstantiated=!0,t.instantiateWithInstances(n,i).then(function(t){e._templateDocumentPart=t,t.fragment=null}).fail(function(e){var n=e.stack||e;throw console.error("Error in",t.getBaseUrl()+":",n),e})})}},_templateDidLoad:{value:function(e){this._setupTemplateObjects(e.objects)}},_loadTemplatePromise:{value:null},_loadTemplate:{value:function(){var e,t=this,i=this._loadTemplatePromise;return i||(e=n.getInfoForObject(this),i=this._loadTemplatePromise=a.getTemplateWithModuleId(this.templateModuleId,e.require).then(function(e){return t._template=e,t._isTemplateLoaded=!0,e})),i}},templateModuleId:{get:function(){return this._templateModuleId||this._getDefaultTemplateModuleId()}},_getDefaultTemplateModuleId:{value:function(){var e,t,i,r;return r=n.getInfoForObject(this),i=r.moduleId,t=i.lastIndexOf("/"),e=i+"/"+i.slice(-1===t?0:t+1,-5)+".html"}},deserializedFromSerialization:{value:function(){this.attachToParentComponent()}},_deserializedFromTemplate:{value:function(e,t,i){n.getInfoForObject(this).label=t,this._ownerDocumentPart=i,this.hasOwnProperty("identifier")||(this.identifier=t),this.ownerComponent||(this.ownerComponent=m.prototype.isPrototypeOf(e)?e:this.rootComponent),this._needsDrawInDeserialization&&(this.needsDraw=!0)}},blueprintModuleId:{serializable:!1,enumerable:!1,get:function(){var e=n.getInfoForObject(this),t=e&&!e.isInstance?this:Object.getPrototypeOf(this);if(!Object.getOwnPropertyDescriptor(t,"_blueprintModuleId")||!t._blueprintModuleId){e=n.getInfoForObject(t);var i=e.moduleId,r=i.lastIndexOf("/"),a=i.lastIndexOf(".");r=-1===r?0:r+1,a=-1===a?i.length:a,a=r>a?i.length:a;var o;o=i.length>a&&".reel"===i.slice(a,i.length)?i+"/"+i.slice(r,a)+".meta":i.slice(0,a)+".meta",n.defineProperty(t,"_blueprintModuleId",{value:o})}return t._blueprintModuleId}},blueprint:e("montage")._blueprintDescriptor,gateDidBecomeTrue:{value:function(e){e===this._canDrawGate?this._canDraw=!0:e===this._blockDrawGate&&(v.componentBlockDraw(this),this._prepareCanDraw())},enumerable:!1},_canDrawGate:{enumerable:!1,value:null},_preparedForActivationEvents:{enumerable:!1,value:!1},_drawIfNeeded:{enumerable:!1,value:function(e){var t,i,r,a,o=this._firstDraw;if(this._treeLevel=e,o&&(this.originalElement=this.element),this.needsDraw&&v.addToDrawCycle(this),o&&this.prepareForDraw&&n.callDeprecatedFunction(this,this.prepareForDraw,"prepareForDraw","enterDocument(firstTime)"),this._needsEnterDocument&&(this._needsEnterDocument=!1,this._inDocument=!0,"function"==typeof this.enterDocument&&this.enterDocument(o),this._enterDocument(o)),o&&(this.originalElement=null),h.isDebug&&h.debug(this,"drawList: "+(this._drawList||[]).length+" of "+this.childComponents.length),null!==this._drawList&&this._drawList.length>0)for(i=this._drawList,this._drawList=[],a=i.length,r=0;a>r;r++)t=i[r],h.isDebug&&h.debug("Parent Component "+(null!=this.element?this.element.id:"")+" drawList length: "+i.length),t._addedToDrawList=!1,h.isDebug&&h.debug(this,"childComponent: "+t.element+"; canDraw: "+t.canDraw()),t.canDraw()&&t._drawIfNeeded(e+1)}},_updateComponentDom:{value:function(){var e,t,n;if(this._firstDraw){for(this._prepareForDraw(),t=this.composerList.length,n=0;t>n;n++)e=this.composerList[n],e.lazyLoad||e._load();this._firstDraw=!1}(null!==this._newDomContent||this._shouldClearDomContentOnNextDraw)&&(h.isDebug&&u.debug("Component content changed: component ",this._montage_metadata.objectName,this.identifier," newDomContent",this._newDomContent),this._performDomContentChanges())}},_replaceElementWithTemplate:{enumerable:!1,value:function(){var e,t,n,i,r=this.element,a=this._templateElement,o=this.element.attributes;for(n=0;i=o[n];n++)e=i.nodeName,t="id"===e||"data-montage-id"===e?i.nodeValue:(a.getAttribute(e)||"")+("style"===e?"; ":" ")+i.nodeValue,a.setAttribute(e,t);this._initializeClassListFromElement(a),r.parentNode?r.parentNode.replaceChild(a,r):this._canDrawOutsideDocument||console.warn("Warning: Trying to replace element ",r," which has no parentNode"),this.eventManager.unregisterEventHandlerForElement(r),this.eventManager.registerEventHandlerForElement(this,a),this._element=a,this._templateElement=null,this._newDomContent&&(this._newDomContent=null,this._shouldClearDomContentOnNextDraw=!1)}},_addTemplateStyles:{value:function(){var e,t,n,i=this._templateDocumentPart;if(i){e=i.template.getResources(),n=this.element.ownerDocument,t=e.createStylesForDocument(n);for(var r,a=0;r=t[a];a++)this.rootComponent.addStylesheet(r)}}},_prepareForDraw:{value:function(){u.isDebug&&u.debug(this,"_templateElement: "+this._templateElement),this._initDomArguments(),this._templateElement&&(this._bindTemplateParametersToArguments(),this._replaceElementWithTemplate())},enumerable:!1},_bindTemplateParametersToArguments:{value:function(){var e,t,n,i,r,a,o,s,l=this._templateDocumentPart.parameters;if(t=this._domArguments,this._template.hasParameters()||1!==t.length){if(i=this._validateTemplateArguments(t,l))throw i;for(var u in l){e=l[u],n=t[u],"*"===u?(o=this._element.ownerDocument.createRange(),o.selectNodeContents(this._element),r=o.extractContents()):r=n,a=this._findAndDetachComponents(r),e.parentNode.replaceChild(r,e);for(var c=0;s=a[c];c++)s.attachToParentComponent()}}}},_validateTemplateArguments:{value:function(e,t){var n,i,r=Object.keys(t);if(0!==r.length)if(null==e){if(r.length>0)return Error("No arguments provided for "+this.templateModuleId+". Arguments needed: "+r+".")}else if("*"in t){if(n=Object.keys(e),n.length>0)return Error('Arguments "'+n+'" were given to component but no named parameters '+"are defined in "+this.templateModuleId)}else{for(i in t)if(!(i in e))return Error('"'+i+'" argument not '+"given in "+this.templateModuleId);for(i in e)if("*"!==i&&!(i in t))return Error('"'+i+'" parameter does '+"not exist in "+this.templateModuleId)}}},prepareForActivationEvents:{enumerable:!1,value:null},_prepareForActivationEvents:{value:function(){var e,t=this.composerList.length;for(t=0;this.composerList.length>t;t++)e=this.composerList[t],e.lazyLoad&&e._load();"function"==typeof this.prepareForActivationEvents&&this.prepareForActivationEvents()}},_performDomContentChanges:{value:function(){var e,t=this._newDomContent,n=this._element.childNodes[0];if(t||this._shouldClearDomContentOnNextDraw){if(e=this._element,e.innerHTML="",Element.isElement(t))e.appendChild(t);else if(null!=t)for(var i,r=0;i=t[r];r++)e.appendChild(i);this._newDomContent=null,"function"==typeof this.contentDidChange&&this.contentDidChange(this._element.childNodes[0],n),this._shouldClearDomContentOnNextDraw=!1}}},prepareForDraw:{enumerable:!1,value:null},draw:{enumerable:!1,value:function(){}},willDraw:{enumerable:!1,value:null},didDraw:{enumerable:!1,value:function(){}},_addedToDrawList:{value:!1},_addToParentsDrawList:{enumerable:!1,value:function(){if(!this._addedToDrawList){var e=this.parentComponent;e?(e._addToDrawList(this),h.isDebug&&h.debug("drawList -- childComponent",this._montage_metadata.objectName," added to ",e._montage_metadata.objectName)):h.isDebug&&h.debug(this,"parentComponent is null")}}},_needsDraw:{value:!1},_needsDrawInDeserialization:{value:!1},needsDraw:{enumerable:!1,get:function(){return!!this._needsDraw},set:function(e){return this.isDeserializing?(this._needsDrawInDeserialization=!0,void 0):(this._needsDraw!==e&&(h.isDebug&&h.debug("NEEDS DRAW TOGGLED "+e+" FOR "+this._montage_metadata.objectName),this._needsDraw=!!e,e&&(this.canDrawGate.value?this._addToParentsDrawList():this.blockDrawGate.setField("drawRequested",!0))),void 0)}},_drawList:{value:null},__addToDrawList:{enumerable:!1,value:function(e){null===this._drawList?(this._drawList=[e],e._addedToDrawList=!0):-1===this._drawList.indexOf(e)&&(this._drawList.push(e),e._addedToDrawList=!0)}},_addToDrawList:{enumerable:!1,value:function(e){this.__addToDrawList(e),this._addToParentsDrawList()}},_templateElement:{enumerable:!1,value:null},surrenderPointer:{value:function(){return!0}},composerList:{value:[],distinct:!0,serializable:!1},addComposer:{value:function(e){this.addComposerForElement(e,e.element)}},addComposerForElement:{value:function(e,t){e.component=this,e.element=t,this.composerList.push(e),this._firstDraw||(e.lazyLoad?this._preparedForActivationEvents&&e._load():e._load())}},scheduleComposer:{value:function(e){this.rootComponent.addToComposerList(e)}},removeComposer:{value:function(e){var t,n;for(n=this.composerList.length,t=0;n>t;t++)if(this.composerList[t].uuid===e.uuid){this.composerList[t].unload(),this.composerList.splice(t,1);break}}},clearAllComposers:{value:function(){var e,t,n=this.composerList;for(t=n.length,e=0;t>e;e++)n[e].unload();n.splice(0,t)}},localizer:{value:null},_waitForLocalizerMessages:{value:!1},waitForLocalizerMessages:{enumerable:!1,get:function(){return this._waitForLocalizerMessages},set:function(e){if(this._waitForLocalizerMessages!==e)if(e!==!0||this.localizer.messages)this._waitForLocalizerMessages=!1,this.canDrawGate.setField("messages",!0);else{if(!this.localizer)throw"Cannot wait for messages on localizer if it is not set";this._waitForLocalizerMessages=!0;var t=this;u.debug(this,"waiting for messages from localizer"),this.canDrawGate.setField("messages",!1),this.localizer.messagesPromise.then(function(){u.isDebug&&u.debug(t,"got messages from localizer"),t.canDrawGate.setField("messages",!0)})}}},_elementAttributeValues:{value:null},_elementAttributeDescriptors:{value:null},_getElementAttributeDescriptor:{value:function(e){for(var t,n=this;n&&n._elementAttributeDescriptors&&!(t=n._elementAttributeDescriptors[e]);)n=Object.getPrototypeOf(n);return t}},defineAttribute:{value:function(e,t){t=t||{};var i="_"+e,r={configurable:void 0===t.configurable?!0:t.configurable,enumerable:void 0===t.enumerable?!0:t.enumerable,set:function(e,t){return function(n){var i=this._getElementAttributeDescriptor(e,this);i&&"boolean"===i.dataType&&(n=n||""===n?!0:!1),void 0!==n&&this[t]!==n&&(this[t]=n,null===this._elementAttributeValues&&(this._elementAttributeValues={}),this._elementAttributeValues[e]=n,this.needsDraw=!0)}}(e,i),get:function(e,t){return function(){return this[t]}}(e,i)};n.defineProperty(this.prototype,i,{value:null}),n.defineProperty(this.prototype,e,r)}},addAttributes:{value:function(e){var t,n,i;this.prototype._elementAttributeDescriptors=e;for(n in e)e.hasOwnProperty(n)&&(i=e[n],null===i||"string"==typeof i?(t={value:i,dataType:"string"},e[n]=t):t=i,void 0===this[n]&&this.defineAttribute(n,t))}},_enterDocument:{value:function(e){var t;if(e){t=this.originalElement;var n,i,r,a,o,s,l;if(n=t.attributes)for(r=n.length,i=0;r>i;i++)a=n[i].name,o=n[i].value,l=this._getElementAttributeDescriptor(a,this),(l||void 0!==this[a])&&(null===this._elementAttributeValues&&(this._elementAttributeValues={}),void 0===this._elementAttributeValues[a]&&(this._elementAttributeValues[a]=o,(void 0===this[a]||null==this[a])&&(this[a]=o)));if(l=this._getElementAttributeDescriptor("textContent",this)){var u=t.textContent;void 0===this._elementAttributeValues.textContent&&(this._elementAttributeValues.textContent=u,null==this.textContent&&(this.textContent=u))}if(this._elementAttributeDescriptors)for(s in this._elementAttributeDescriptors){l=this._elementAttributeDescriptors[s];var c="_"+s;null===this[c]&&null!==l&&"value"in l&&(this[c]=this._elementAttributeDescriptors[s].value)}}}},_draw:{value:function(){var e,t=this.element;for(var n in this._elementAttributeValues)if(this._elementAttributeValues.hasOwnProperty(n)){var i=this[n];e=this._getElementAttributeDescriptor(n,this),e&&("boolean"===e.dataType?i===!0?(t[n]=!0,t.setAttribute(n,n.toLowerCase())):(t[n]=!1,t.removeAttribute(n)):void 0!==i&&("textContent"===n?t.textContent=i:t.setAttribute(n,i))),delete this._elementAttributeValues[n]}this._drawClassListIntoComponent()}},_classList:{value:null},_classListDirty:{value:!1},classList:{get:function(){return null===this._classList&&(this._classList=new p,this._subscribeToToClassListChanges(),this._initializeClassListFromElement(this.element)),this._classList}},_initializeClassListFromElement:{value:function(e){var t;if(e&&e.className&&(t=e.className.trim())&&0!==t.length){var n=this.classList;this._unsubscribeToClassListChanges&&this._unsubscribeToClassListChanges(),n.addEach(t.split(/\s+/)),this._subscribeToToClassListChanges()}}},_unsubscribeToClassListChanges:{value:null},_subscribeToToClassListChanges:{value:function(){this._unsubscribeToClassListChanges=this._classList.addRangeChangeListener(this,"classList")}},handleClassListRangeChange:{value:function(){this._classListDirty=!0,this.needsDraw=!0}},_drawClassListIntoComponent:{value:function(){if(this._classListDirty){for(var e,t=this.element.classList,n=this._classList,i=0,r=t.length;r>i;i++)e=t.item(i),n.has(e)||(t.remove(e),i--,r--);this._classList.forEach(function(e){t.add(e)}),this._classListDirty=!1}}},dispose:{value:function(){this.cancelBindings(),this.detachFromParentComponent(),d.unregisterEventHandlerForElement(this,this._element),this._element=null,this.childComponents.forEach(function(e){e.dispose()})}}}),f=m.specialize({constructor:{value:function f(){this.super()}},init:{value:function(){return this}},needsDraw:{enumerable:!0,get:function(){return!1},set:function(e){if(this._needsDraw!==e&&(this._needsDraw=!!e,e))for(var t,n=this.childComponents,i=0;t=n[i];i++)h.isDebug&&h.debug(this,"needsDraw = true for: "+t._montage_metadata.exportedSymbol),t.needsDraw=!0}},canDrawGate:{get:function(){return this._canDrawGate||(this._canDrawGate=(new s).initWithDelegate(this))}},_clearNeedsDrawTimeOut:{value:null},_needsDrawList:{value:[]},_cannotDrawList:{value:null},componentBlockDraw:{value:function(e){this._cannotDrawList=this._cannotDrawList?this._cannotDrawList:{},this._cannotDrawList[e.uuid]=e,this._clearNeedsDrawTimeOut&&(window.clearTimeout(this._clearNeedsDrawTimeOut),this._clearNeedsDrawTimeOut=null)}},componentCanDraw:{value:function(e,t){if(t){if(!this._cannotDrawList)return;if(delete this._cannotDrawList[e.uuid],this._needsDrawList.push(e),0===Object.keys(this._cannotDrawList).length&&this._needsDrawList.length>0&&!this._clearNeedsDrawTimeOut){var n=this;this._clearNeedsDrawTimeOut=window.setTimeout(function(){n._clearNeedsDrawList()},0)}}else this._clearNeedsDrawTimeOut&&(window.clearTimeout(this._clearNeedsDrawTimeOut),this._clearNeedsDrawTimeOut=null)}},_clearNeedsDrawList:{value:function(){var e,t,n,i=this._needsDrawList;for(n=i.length,t=0;n>t;t++)e=i[t],e.needsDraw&&e._addToParentsDrawList();this._clearNeedsDrawTimeOut=null,i.splice(0,n)}},removeFromCannotDrawList:{value:function(e){if(this._cannotDrawList&&(delete this._cannotDrawList[e.uuid],0===Object.keys(this._cannotDrawList).length&&this._needsDrawList.length>0&&!this._clearNeedsDrawTimeOut)){var t=this;this._clearNeedsDrawTimeOut=window.setTimeout(function(){t._clearNeedsDrawList()},0)}}},_cancelDrawIfScheduled:{value:function(){var e=this.requestedAnimationFrame,t=this.cancelAnimationFrame;null!==e&&(this._frameTime||(u.isDebug&&u.debug(this,"clearing draw"),t?t.call(window,e):window.clearTimeout(e),this.requestedAnimationFrame=null))}},_addToDrawList:{value:function(e){this.__addToDrawList(e),h.isDebug&&h.debug(this,this.canDrawGate.value,this.requestedAnimationFrame),this.drawTree()},enumerable:!1},addToComposerList:{value:function(e){this.composerList.push(e),h.isDebug&&h.debug(this,e,"Added to composer list"),this._scheduleComposerRequest=!0,this.drawTree()}},composerListSwap:{value:[],distinct:!0},_scheduleComposerRequest:{value:!1},requestedAnimationFrame:{value:null,enumerable:!1},requestAnimationFrame:{value:window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame,enumerable:!1},cancelAnimationFrame:{value:window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame,enumerable:!1},_frameTime:{value:null},_oldSource:{value:null},_diff:{value:function(e,t){for(var n={},i={},r=0;t.length>r;r++)null==n[t[r]]&&(n[t[r]]={rows:[],o:null}),n[t[r]].rows.push(r);for(r=0;e.length>r;r++)null==i[e[r]]&&(i[e[r]]={rows:[],n:null}),i[e[r]].rows.push(r);for(r in n)1===n[r].rows.length&&void 0!==i[r]&&1===i[r].rows.length&&(t[n[r].rows[0]]={text:t[n[r].rows[0]],row:i[r].rows[0]},e[i[r].rows[0]]={text:e[i[r].rows[0]],row:n[r].rows[0]});for(r=0;t.length-1>r;r++)null!=t[r].text&&null==t[r+1].text&&t[r].row+1<e.length&&null==e[t[r].row+1].text&&t[r+1]==e[t[r].row+1]&&(t[r+1]={text:t[r+1],row:t[r].row+1},e[t[r].row+1]={text:e[t[r].row+1],row:r+1});for(r=t.length-1;r>0;r--)null!=t[r].text&&null==t[r-1].text&&t[r].row>0&&null==e[t[r].row-1].text&&t[r-1]==e[t[r].row-1]&&(t[r-1]={text:t[r-1],row:t[r].row-1},e[t[r].row-1]={text:e[t[r].row-1],row:r-1});return{o:e,n:t}}},_previousDrawDate:{enumerable:!1,value:0},_documentResources:{value:null},_needsStylesheetsDraw:{value:!1},_stylesheets:{value:[]},addStylesheet:{value:function(e){this._stylesheets.push(e),this._needsStylesheetsDraw=!0}},drawStylesheets:{value:function(){for(var e,t=this._documentResources,n=this._stylesheets;e=n.shift();)t.addStyle(e);this._needsStylesheetsDraw=!1}},drawTree:{value:function(){if(null===this.requestedAnimationFrame){h.isDebug&&h.debug(this,"requesting a draw");var e=this,t=this.requestAnimationFrame,n=function(t){var n;if(e._needsStylesheetsDraw&&e.drawStylesheets(),!e._documentResources.areStylesLoaded)return c.isDebug&&console.log("Draw Cycle Waiting Stylesheets: ",e._documentResources._expectedStyles.length),e.requestedAnimationFrame=null,e.drawTree(),void 0;if(c.isDebug&&(n=window.performance?window.performance.now():Date.now()),e._frameTime=t?t:Date.now(),e._clearNeedsDrawTimeOut&&e._clearNeedsDrawList(),h.isDebug){var i=document.documentElement.innerHTML;if(e._oldSource&&i!==e._oldSource){for(var r=["DOM modified outside of the draw loop"],a=e._diff(e._oldSource.split("\n"),i.split("\n")),o=0;a.n.length>o;o++)if(null==a.n[o].text)r.push("+ "+a.n[o]);else for(var s=a.n[o].row+1;a.o.length>s&&null==a.o[s].text;s++)r.push("- "+a.o[s]);console.warn(r.join("\n"))}console.group((t?h.toTimeString(new Date(t))+" ":"")+"Draw Fired")}if(e.drawIfNeeded(),c.isDebug){if(window.performance)var l=window.performance.now();else var l=Date.now();console.log("Draw Cycle Time: ",l-n,", Components: ",e._lastDrawComponentsCount)}h.isDebug&&(console.groupEnd(),e._oldSource=document.documentElement.innerHTML),e._frameTime=null,e._scheduleComposerRequest&&e.drawTree()};if(t)this.requestedAnimationFrame=t.call(window,n);else{var i=Date.now(),r=17-i+this._previousDrawDate;0>r&&(r=0),this.requestedAnimationFrame=setTimeout(n,r),this._previousDrawDate=i+r}this._scheduleComposerRequest=!1}},enumerable:!1},_readyToDrawList:{enumerable:!1,value:[]},_readyToDrawListIndex:{enumerable:!1,value:null},addToDrawCycle:{value:function(e){var t=this._readyToDrawListIndex;return t.hasOwnProperty(e.uuid)?(h.isDebug&&h.debug("components should not be added to the draw cycle twice"),void 0):(this._readyToDrawList.push(e),this._readyToDrawListIndex[e.uuid]=!0,e._updateComponentDom(),void 0)}},_lastDrawComponentsCount:{value:null},drawIfNeeded:{value:function(){var e,t,n,i,r,a,o=this._readyToDrawList,s=0,l=this.composerList;if(o.length=0,a=l.length,this._readyToDrawListIndex={},a>0){for(this.composerList=this.composerListSwap,t=0;a>t;t++)r=l[t],r.needsFrame=!1,r.frame(this._frameTime);
l.splice(0,a),this.composerListSwap=l}for(this._drawIfNeeded(0),n=o.length;n>s;){for(t=s;n>t;t++)e=o[t],"function"==typeof e.willDraw&&e.willDraw(this._frameTime),h.isDebug&&h.debug(e._montage_metadata.objectName," willDraw treeLevel ",e._treeLevel);this._drawIfNeeded(0),s=n,n=o.length}var u=function(e,t){return e._treeLevel-t._treeLevel};for(o.sort(u),t=0;n>t;t++)e=o[t],e.needsDraw=!1;for(this.requestedAnimationFrame=null,t=n-1;t>=0;t--)e=o[t],e._draw(this._frameTime),e.draw(this._frameTime),h.isDebug&&h.debug(e._montage_metadata.objectName," draw treeLevel ",e._treeLevel);for(t=0;n>t;t++)e=o[t],e.didDraw(this._frameTime),e._completedFirstDraw||(i=document.createEvent("CustomEvent"),i.initCustomEvent("firstDraw",!0,!1,null),e.dispatchEvent(i),e._completedFirstDraw=!0),h.isDebug&&h.debug(e._montage_metadata.objectName," didDraw treeLevel ",e._treeLevel);return c.isDebug&&(this._lastDrawComponentsCount=o.length),!!o.length}},element:{get:function(){return this._element},set:function(e){d.registerEventHandlerForElement(this,e),this._element=e,this._documentResources=o.getInstanceForDocument(e)}}}),v=(new f).init();t.__root__=v}}),montageDefine("bfd16e7","core/template",{dependencies:["montage","core/serialization","core/document-part","core/document-resources","core/serialization/serialization","core/serialization/serializer/montage-labeler","core/promise","core/mini-url","core/logger","core/event/event-manager","core/application"],factory:function(e,t){function n(e,t,n){var i,r,a=new d,s=e.documentElement.outerHTML,l=new o,u=e.documentElement;return i=a.createHtmlDocumentWithHtml(s,e.location.href),a.initWithDocument(i,t).then(function(){return a.setBaseUrl(e.location.href),r=a._createTemplateObjects(n),l.initWithTemplateAndFragment(a),a._instantiateObjects(r,u).then(function(e){return l.objects=e,a._invokeDelegates(l),l})})}var i,r=e("montage").Montage,a=e("core/serialization").Deserializer,o=e("core/document-part").DocumentPart,s=e("core/document-resources").DocumentResources,l=e("core/serialization/serialization").Serialization,u=e("core/serialization/serializer/montage-labeler").MontageLabeler,c=e("core/promise").Promise,h=e("core/mini-url");e("core/logger").logger("template"),e("core/event/event-manager").defaultEventManager;var d=r.specialize({_SERIALIZATON_SCRIPT_TYPE:{value:"text/montage-serialization"},_ELEMENT_ID_ATTRIBUTE:{value:"data-montage-id"},PARAM_ATTRIBUTE:{value:"data-param"},_require:{value:null},_resources:{value:null},document:{value:null},_baseUrl:{value:null},_instances:{value:null},_metadata:{value:null},_objectsString:{value:null},objectsString:{get:function(){return this._objectsString},set:function(e){this._objectsString=e,this._serialization&&this._serialization.initWithString(e),this.__deserializer=null}},__deserializer:{value:null},_deserializer:{get:function(){var e,t,n=this.__deserializer;if(!n){if(e=this._metadata){t=Object.create(null);for(var i in e)t[i]=e[i].require}n=(new a).init(this.objectsString,this._require,t),this.__deserializer=n}return n}},getDeserializer:{value:function(){return this._deserializer}},_serialization:{value:null},getSerialization:{value:function(){var e=this._serialization;return e||(e=this._serialization=new l,e.initWithString(this.objectsString)),e}},constructor:{value:function d(){this.super()}},initWithRequire:{value:function(e){return this._require=e,this.document=this.createHtmlDocumentWithHtml(""),this.objectsString="",this}},initWithDocument:{value:function(e,t){var n=this;return this._require=t,this.setDocument(e),this.getObjectsString(e).then(function(e){return n.objectsString=e,n})}},initWithHtml:{value:function(e,t){var n=this;return this._require=t,this.document=this.createHtmlDocumentWithHtml(e),this.getObjectsString(this.document).then(function(e){return n.objectsString=e,n})}},initWithObjectsAndDocumentFragment:{value:function(e,t,n){return this._require=n,this.document=this.createHtmlDocumentWithHtml(""),this.document.body.appendChild(this.document.importNode(t,!0)),this.setObjects(e),this}},initWithModuleId:{value:function(e,t){var n=this;return this._require=t,this.createHtmlDocumentWithModuleId(e,t).then(function(i){var r=t(e).directory;return n.document=i,n.setBaseUrl(r),n.getObjectsString(i).then(function(e){return n.objectsString=e,n})})}},clone:{value:function(){var e=new d;return e._require=this._require,e._baseUrl=this._baseUrl,e.setDocument(this.document),e.objectsString=this.objectsString,e._instances=Object.clone(this._instances,1),e}},instantiate:{value:function(e){return this.instantiateWithInstances(null,e)}},instantiateWithInstances:{value:function(e,t){var n,i,r,a=this,s=new o;return e=e||this._instances,n=this._createMarkupDocumentFragment(t),r=this._getParameters(n),s.initWithTemplateAndFragment(this,n),s.startActingAsTopComponent(),s.parameters=r,i=this._createTemplateObjects(e),this._instantiateObjects(i,n).then(function(n){var i;return s.objects=n,a._invokeDelegates(s,e),s.stopActingAsTopComponent(),i=a.getResources(),!i.resourcesLoaded()&&i.hasResources()&&i.loadResources(t),s})}},_objectsInstantiationOptimized:{value:!1},_optimizeObjectsInstantiationPromise:{value:null},_optimizeObjectsInstantiation:{value:function(){var e,t=this;return this._objectsInstantiationOptimized?void 0:(this._optimizeObjectsInstantiationPromise||(e=this._deserializer.preloadModules(),e?this._optimizeObjectsInstantiationPromise=e.then(function(){t._objectsInstantiationOptimized=!0}):this._objectsInstantiationOptimized=!0),this._optimizeObjectsInstantiationPromise)}},setBaseUrl:{value:function(e){this._baseUrl=e}},getBaseUrl:{value:function(){return this._baseUrl}},getResources:{value:function(){var e=this._resources;return e||(e=this._resources=new p,e.initWithTemplate(this)),e}},_createTemplateObjects:{value:function(t){var n=Object.create(t||null);return void 0===i&&(i=e("core/application").application),n.application=i,n.template=this,n}},_instantiateObjects:{value:function(e,t){var n,i=this._deserializer;return n=this._optimizeObjectsInstantiation(),n?n.then(function(){return i.deserialize(e,t)}):i.deserialize(e,t)}},_createMarkupDocumentFragment:{value:function(e){for(var t=e.createDocumentFragment(),n=this.document.body.childNodes,i=0,r=n.length;r>i;i++)t.appendChild(e.importNode(n[i],!0));return t}},getParameterName:{value:function(e){return e.getAttribute(this.PARAM_ATTRIBUTE)}},getParameters:{value:function(){return this._getParameters(this.document.body)}},_getParameters:{value:function(e){for(var t,n=e.querySelectorAll("*["+this.PARAM_ATTRIBUTE+"]"),i=n.length,r={},a=0;i>a;a++){t=n[a];var o=this.getParameterName(t);if(o in r)throw Error('The parameter "'+o+'" is'+" declared more than once in "+this.getBaseUrl()+".");r[o]=t}if("*"in r&&i>1)throw Error('The star "*" template parameter was declared when other parameters were also present in '+this.getBaseUrl()+": "+Object.keys(r)+".");return r}},hasParameters:{value:function(){return!!this.document.querySelector("*["+this.PARAM_ATTRIBUTE+"]")}},_invokeDelegates:{value:function(e,t){var n,i,r=e.objects,a=r.owner||t&&t.owner;for(var o in r)t&&o in t||(n=r[o],i=this._getObjectOwner(o,a),n&&("function"==typeof n._deserializedFromTemplate&&n._deserializedFromTemplate(i,o,e),"function"==typeof n.deserializedFromTemplate&&n.deserializedFromTemplate(i,o,e)));if(a){var s=this.getSerialization();s.isExternalObject("owner")||("function"==typeof a._templateDidLoad&&a._templateDidLoad(e),"function"==typeof a.templateDidLoad&&a.templateDidLoad(e))}}},setInstances:{value:function(e){this._instances=e}},getInstances:{value:function(){return this._instances}},setObjects:{value:function(e){this.objectsString=JSON.stringify(e,null,4)}},setObjectMetadata:{value:function(e,t,n,i){var r=this._metadata;r||(this._metadata=r=Object.create(null)),r[e]={require:t,label:n,owner:i},this.__deserializer=null}},getObjectMetadata:{value:function(e){var t=this._metadata;return t&&e in t?t[e]:{require:this._require,label:e}}},_getObjectOwner:{value:function(e,t){var n,i=this._metadata;return n=i&&e in i?i[e].owner:t}},setDocument:{value:function(e){var t=e.documentElement.innerHTML;this.document=this.createHtmlDocumentWithHtml(t,e.baseURI)}},getObjectsString:{value:function(e){var t;return t=this.getInlineObjectsString(e),null===t?this.getExternalObjectsString(e):c.resolve(t)}},getInlineObjectsString:{value:function(e){var t="script[type='"+this._SERIALIZATON_SCRIPT_TYPE+"']",n=e.querySelector(t);return n?n.textContent:null}},getExternalObjectsString:{value:function(e){var t,n,i,r,a=e.querySelector('link[rel="serialization"]');return a?(t=new XMLHttpRequest,n=a.getAttribute("href"),i=this.getBaseUrl()||"",/^https?:\/\/|^\//.test(n)?c.reject(Error("Relative link found for the objects file but the document URL is unknown: '"+n+"'.")):(n=i+n,r=c.defer(),t.open("GET",n),t.addEventListener("load",function(){200==t.status?r.resolve(t.responseText):r.reject(Error("Unable to retrive '"+n+"', code status: "+t.status))},!1),t.addEventListener("error",function(e){r.reject(Error("Unable to retrive '"+n+"' with error: "+e.error+"."))},!1),t.send(),r.promise)):c.resolve(null)}},createHtmlDocumentWithHtml:{value:function(e,t){var n=document.implementation.createHTMLDocument("");return n.documentElement.innerHTML=e,this.normalizeRelativeUrls(n,t),n}},createHtmlDocumentWithModuleId:{value:function(e,t){var n=this;return"function"!=typeof t?c.reject(Error("Missing 'require' function to load module '"+e+"'.")):t.async(e).then(function(e){return n.createHtmlDocumentWithHtml(e.content,e.directory)})}},_removeObjects:{value:function(e){var t="script[type='"+this._SERIALIZATON_SCRIPT_TYPE+"'], link[rel='serialization']";Array.prototype.forEach.call(e.querySelectorAll(t),function(e){e.parentNode.removeChild(e)})}},_addObjects:{value:function(e,t){if(t){var n=e.createElement("script");n.setAttribute("type",this._SERIALIZATON_SCRIPT_TYPE),n.textContent=JSON.stringify(JSON.parse(t),null,4),e.head.appendChild(n)}}},_templateFromElementContentsCache:{value:null},clearTemplateFromElementContentsCache:{value:function(){this._templateFromElementContentsCache=null}},createTemplateFromElementContents:{value:function(e){var t,n,i,r=this._templateFromElementContentsCache;return r||(r=Object.create(null),this._templateFromElementContentsCache=r),e in r?Object.create(r[e]):(t=this.getElementById(e),i=this.document.createRange(),i.selectNodeContents(t),n=this.createTemplateFromRange(i),r[e]=n,Object.create(n))}},createTemplateFromElement:{value:function(e){var t,n;return t=this.getElementById(e),n=this.document.createRange(),n.selectNode(t),this.createTemplateFromRange(n)}},createTemplateFromRange:{value:function(e){var t,n,i,r,a,o=new l;return t=e.cloneContents(),n=this._getChildrenElementIds(t),o.initWithString(this.objectsString),i=o.getSerializationLabelsWithElements(n),a=o.extractSerialization(i,["owner"]),r=new d,r.initWithObjectsAndDocumentFragment(null,t,this._require),r.objectsString=a.getSerializationString(),r._resources=this.getResources(),r}},_createSerializationWithElementIds:{value:function(e){var t,n,i=new l;return i.initWithString(this.objectsString),t=i.getSerializationLabelsWithElements(e),n=i.extractSerialization(t,["owner"])}},expandParameters:{value:function(e,t){var n,i,r,a,o,s,l=[],u={},c=this.getSerialization(),h={};n=this.getParameters();for(var d in n)if(a=n[d],o=t.getTemplateParameterArgument(e,d),l.push.apply(l,this._getElementIds(o)),i=this.replaceNode(o,a))for(var p in i)u[p]=i[p];return h.elementIds=l,h.elementIdsCollisions=u,s=e._createSerializationWithElementIds(l),s.renameElementReferences(u),r=c.mergeSerialization(s),this.objectsString=c.getSerializationString(),h.labels=s.getSerializationLabels(),h.labelsCollisions=r,h}},_resolveElementIdCollisions:{value:function(e){var t,n,i,r,a,o=new u;i=this.getElementIds();for(var s,l=0;s=i[l];l++)o.setObjectLabel(null,s);n=this._getElements(e);for(var s in n)this.getElementById(s)&&(r=n[s],a=o.getObjectLabel(r),this.setElementId(r,a),t||(t=Object.create(null)),t[s]=a);return t}},replaceNode:{value:function(e,t){var n;return n=this._resolveElementIdCollisions(e),this.normalizeRelativeUrls(e,this.getBaseUrl()),t.parentNode.replaceChild(e,t),n}},insertNodeBefore:{value:function(e,t){var n;return n=this._resolveElementIdCollisions(e),this.normalizeRelativeUrls(e,this.getBaseUrl()),t.parentNode.insertBefore(e,t),n}},appendNode:{value:function(e,t){var n;return n=this._resolveElementIdCollisions(e),this.normalizeRelativeUrls(e,this.getBaseUrl()),t.appendChild(e),n}},getElementId:{value:function(e){return e.getAttribute?e.getAttribute(this._ELEMENT_ID_ATTRIBUTE):void 0}},setElementId:{value:function(e,t){e.setAttribute(this._ELEMENT_ID_ATTRIBUTE,t)}},getElementIds:{value:function(){return this._getElementIds(this.document.body)}},_getElements:{value:function(e){var t,n,i="*["+this._ELEMENT_ID_ATTRIBUTE+"]",r={};t=e.querySelectorAll(i);for(var a,o=0;a=t[o];o++)n=this.getElementId(a),r[n]=a;return n=this.getElementId(e),n&&(r[n]=e),r}},_getChildrenElementIds:{value:function(e){var t,n="*["+this._ELEMENT_ID_ATTRIBUTE+"]",i=[];t=e.querySelectorAll(n);for(var r,a=0;r=t[a];a++)i.push(this.getElementId(r));return i}},_getElementIds:{value:function(e){var t,n=this._getChildrenElementIds(e);return t=this.getElementId(e),t&&n.push(t),n}},getElementById:{value:function(e){var t="*["+this._ELEMENT_ID_ATTRIBUTE+"='"+e+"']";return this.document.querySelector(t)}},html:{get:function(){var e=this.document;return this._removeObjects(e),this._addObjects(e,this.objectsString),this._getDoctypeString(e.doctype)+"\n"+e.documentElement.outerHTML}},_getDoctypeString:{value:function(e){return"<!DOCTYPE "+e.name+(e.publicId?' PUBLIC "'+e.publicId+'"':"")+(!e.publicId&&e.systemId?" SYSTEM":"")+(e.systemId?' "'+e.systemId+'"':"")+">"}},normalizeRelativeUrls:{value:function(e,t){if("string"==typeof t&&""!==t&&"about:blank"!==t)for(var n="http://www.w3.org/1999/xlink",i=/^[\w\-]+:|^\//,r=-1!==d._NORMALIZED_TAG_NAMES.indexOf(e.tagName)?[e]:e.querySelectorAll(d._NORMALIZED_TAG_NAMES_SELECTOR),a=0,o=r.length;o>a;a++){var s,l=r[a];"image"===l.tagName?(s=l.getAttributeNS(n,"href"),i.test(s)||l.setAttributeNS(n,"href",h.resolve(t,s))):(s=l.getAttribute("src"),i.test(s)||l.setAttribute("src",h.resolve(t,s)))}}}},{_templateCache:{value:{moduleId:Object.create(null)}},_getTemplateCacheKey:{value:function(e,t){return e=t.resolve(e),t.location+"#"+e}},getTemplateWithModuleId:{value:function(e,t){var n,i;return n=this._getTemplateCacheKey(e,t),i=this._templateCache.moduleId[n],i||(i=(new d).initWithModuleId(e,t),this._templateCache.moduleId[n]=i),i}},_NORMALIZED_TAG_NAMES:{value:["IMG","image","IFRAME"]},__NORMALIZED_TAG_NAMES_SELECTOR:{value:null},_NORMALIZED_TAG_NAMES_SELECTOR:{get:function(){return this.__NORMALIZED_TAG_NAMES_SELECTOR||(this.__NORMALIZED_TAG_NAMES_SELECTOR=this._NORMALIZED_TAG_NAMES.join(",")),this.__NORMALIZED_TAG_NAMES_SELECTOR}}}),p=r.specialize({_resources:{value:null},_resourcesLoaded:{value:!1},template:{value:null},rootUrl:{value:""},constructor:{value:function p(){this._resources=Object.create(null)}},initWithTemplate:{value:function(e){this.template=e}},hasResources:{value:function(){return this.getStyles().length>0||this.getScripts().length>0}},resourcesLoaded:{value:function(){return this._resourcesLoaded}},loadResources:{value:function(e){return this._resourcesLoaded=!0,c.all([this.loadScripts(e),this.loadStyles(e)])}},getScripts:{value:function(){var e,t,n,i=this._resources.scripts;if(!i){t=this.template,i=this._resources.scripts=[],n=t.document.querySelectorAll("script");for(var r=0,a=n.length;a>r;r++)e=n[r],e.type!==this.template._SERIALIZATON_SCRIPT_TYPE&&i.push(e)}return i}},loadScripts:{value:function(e){var t,n=[];t=this.getScripts();for(var i=0,r=t.length;r>i;i++)n.push(this.loadScript(t[i],e));return c.all(n)}},loadScript:{value:function(e,t){var n,i;return n=s.getInstanceForDocument(t),i=this._cloneScriptElement(e,t),n.addScript(i)}},_cloneScriptElement:{value:function(e,t){for(var n,i=t.createElement("script"),r=e.attributes,a=0,o=r.length;o>a;a++)n=r[a],i.setAttribute(n.name,n.value);return i}},getStyles:{value:function(){var e,t,n,i=this._resources.styles;return i||(n='link[rel="stylesheet"], style',e=this.template,t=e.document.querySelectorAll(n),i=Array.prototype.slice.call(t,0),this._resources.styles=i),i}},loadStyles:{value:function(e){var t,n=[];t=this.getStyles();for(var i=0,r=t.length;r>i;i++)n.push(this.loadStyle(t[i],e));return c.all(n)}},loadStyle:{value:function(e,t){var n,i,r=this.template.getBaseUrl();return n=e.getAttribute("href"),n?(i=s.getInstanceForDocument(t),n=i.normalizeUrl(n,r),i.preloadResource(n)):c.resolve()}},createStylesForDocument:{value:function(e){var t,n,i,r,a=this.getStyles(),o=[],l=this.template.getBaseUrl();n=s.getInstanceForDocument(e);for(var u,c=0;u=a[c];c++)i=u.getAttribute("href"),t=e.importNode(u,!0),o.push(t),i&&(r=n.normalizeUrl(i,l),t.setAttribute("href",r));return o}}});t.Template=d,t.TemplateResources=p,t.instantiateDocument=n}}),montageDefine("bfd16e7","core/serialization/serialization",{dependencies:["core/core","./serializer/montage-labeler","./deserializer/montage-reviver","frb/parse","frb/stringify"],factory:function(e,t){var n=e("core/core").Montage,i=e("./serializer/montage-labeler").MontageLabeler,r=e("./deserializer/montage-reviver").MontageReviver,a=e("frb/parse"),o=e("frb/stringify"),s=n.specialize({_serializationString:{value:null},_serializationObject:{value:null},initWithString:{value:function(e){return this._serializationString=e,this._serializationObject=null,this}},initWithObject:{value:function(e){return this._serializationString=null,this._serializationObject=e,this}},getSerializationObject:{value:function(){return this._serializationObject||(this._serializationObject=JSON.parse(this._serializationString)),this._serializationObject}},getSerializationString:{value:function(){return this._serializationString||(this._serializationString=JSON.stringify(this._serializationObject)),this._serializationString}},getSerializationLabels:{value:function(){var e=this.getSerializationObject();return Object.keys(e)}},getExternalObjectLabels:{value:function(){var e=this.getSerializationObject(),t=[];for(var n in e)0===Object.keys(e[n]).length&&t.push(n);return t}},isExternalObject:{value:function(e){var t=this.getSerializationObject();return t&&e in t?0===Object.keys(t[e]).length:!1}},getSerializationLabelsWithElements:{value:function(e){var t=new u,n=[];return t.initWithSerialization(this),t.visitSerialization(function(t){"Element"===t.type&&e.indexOf(t.data)>=0&&(t=t.parent,t&&"properties"===t.name&&(t=t.parent,t&&"montageObject"===t.type&&n.push(t.label)))}),n}},renameElementReferences:{value:function(e){var t=new u;t.initWithSerialization(this),t.visitSerialization(function(t){"Element"===t.type&&t.data in e&&(t.data=e[t.data])})}},renameSerializationLabels:{value:function(e){var t=new u;t.initWithSerialization(this),t.visitSerialization(function(t){if(t.label){var n=t.label;n in e&&(t.label=e[n])}if("reference"===t.type){var i=t.data;i in e&&(t.data=e[i])}})}},mergeSerialization:{value:function(e){return l.mergeSerializations(this,e)}},extractSerialization:{value:function(e,t){var n=new c;return n.initWithSerialization(this),n.extractSerialization(e,t)}}}),l=n.specialize(null,{mergeSerializations:{value:function(e,t){var n,i,r,a,o,l;a=e.getSerializationLabels(),o=t.getSerializationLabels(),l=this._createCollisionTable(a,o),l&&(r=t.getSerializationString(),t=(new s).initWithString(r),t.renameSerializationLabels(l),o=t.getSerializationLabels()),n=e.getSerializationObject(),i=t.getSerializationObject();for(var u,c=0;u=o[c];c++)n[u]=i[u];return e.initWithObject(n),l}},_createCollisionTable:{value:function(e,t){for(var n=new i,r={},a=!1,o=0;e.length>o;o++)n.setObjectLabel(null,e[o]);for(var s,o=0;s=t[o];o++)e.indexOf(s)>=0&&(r[s]=n.generateObjectLabel({}),a=!0);return a?r:void 0}}}),u=n.specialize({initWithSerialization:{value:function(e){this._serialization=e}},visitSerialization:{value:function(e){var t=this._serialization.getSerializationObject();this._walkRootObjects(e,t),this._serialization.initWithObject(t)}},visitSerializationObject:{value:function(e,t){var n=this._serialization.getSerializationObject();if(!(e in n))throw Error('Object "'+e+'" does not exist in '+this._serialization.getSerializationString());this._walkRootObject(t,n,e),this._serialization.initWithObject(n)}},changeLabel:{value:function(e,t){var n,i=this._serialization.getSerializationObject();n=i[e],delete i[e],i[t]=n}},_walkRootObjects:{value:function(e,t){for(var n in t)this._walkRootObject(e,t,n)}},_walkRootObject:{value:function(e,t,n){var i=t[n];"value"in i?this._walkObject(e,i,"value",n):this._walkCustomObject(e,t,n)}},_walkObject:{value:function(e,t,n,i,a){var o,s=t[n],l=r.getTypeOf(s);if(o={type:l},i?o.label=i:o.name=n,a&&(o.parent=a),"number"===l||"string"===l||"null"===l)o.data=s,e(o),t[n]=o.data;else if("regexp"===l)o.data=s["/"],e(o),s["/"]=o.data;else if("reference"===l)o.data=s["@"],e(o),s["@"]=o.data;else if("Element"===l)o.data=s["#"],e(o),s["#"]=o.data;else if("array"===l){o.data=s,e(o),t[n]=s=o.data;for(var u=0,c=s.length;c>u;u++)this._walkObject(e,s,""+u,null,o)}else if("object"===l){o.data=s,e(o),t[n]=s=o.data;for(var n in s)this._walkObject(e,s,n,null,o)}o.label!=i&&this.changeLabel(i,o.label)}},_walkCustomObject:{value:function(e,t,n){var i,r=t[n];i={type:"montageObject",label:n,data:r},e(i),t[n]=r=i.data,i.label!=n&&this.changeLabel(n,i.label),r.properties&&this._walkObject(e,r,"properties",null,i),r.listeners&&this._walkObject(e,r,"listeners",null,i),r.bindings&&this._walkBindings(e,r,null,i),r.localizations&&this._walkLocalizations(e,r,null,i)}},_walkBindings:{value:function(e,t,n){var i,r=t.bindings;i={type:"bindings",data:r,parent:n},e(i),t.bindings=r=i.data;for(var a in r)this._walkBinding(e,r,a,i)}},_walkBinding:{value:function(e,t,n,i){var r,a=t[n];r={type:"binding",name:n,data:a,parent:i},e(r),t[n]=a=r.data,this._walkBindingData(e,a,r)}},_walkBindingData:{value:function(e,t,n){var i,r,s=!1;i=t["<-"]||t["<->"],r=a(i),this._walksBindingReferences(r,function(t){var n={type:"reference",data:t.label};e(n),t.label!==n.data&&(t.label=n.data,s=!0)}),s&&("<-"in t?t["<-"]=o(r):t["<->"]=o(r)),t.converter&&this._walkObject(e,t,"converter",null,n)}},_walkLocalizations:{value:function(e,t,n){var i,r=t.localizations;i={type:"localizations",data:r,parent:n},e(i),t.localizations=r=i.data;for(var a in r)this._walkLocalization(e,r,a,i)}},_walkLocalization:{value:function(e,t,n,i){var r,a,o=t[n];if(r={type:"localization",name:n,data:o,parent:i},e(r),t[n]=o=r.data,"object"==typeof o.key&&this._walkBindingData(e,o.key,r),"object"==typeof o.default&&this._walkBindingData(e,o.default,r),"object"==typeof o.data){a=o.data;for(var n in a)this._walkBindingData(e,a[n],r)}}},_walksBindingReferences:{value:function(e,t){var n=e.args;if("component"===e.type&&t(e),n)for(var i=0,r=n.length;r>i;i++)this._walksBindingReferences(n[i],t)}}}),c=n.specialize({_serialization:{value:null},initWithSerialization:{value:function(e){this._serialization=e}},extractSerialization:{value:function(e,t){var n,i=new u,r={},a=[];n=this._serialization.getSerializationObject(),i.initWithSerialization(this._serialization);for(var o,l=0;o=e[l];l++)r[o]=n[o],i.visitSerializationObject(o,function(t){var n;"reference"===t.type&&(n=t.data,-1===a.indexOf(n)&&-1===e.indexOf(n)&&a.push(n))});if(t)for(var o,l=0;o=t[l];l++)o in n&&!(o in r)&&(r[o]={});for(var o,l=0;o=a[l];l++)r[o]={};return(new s).initWithObject(r)}}});t.Serialization=s,t.SerializationMerger=l,t.SerializationInspector=u,t.SerializationExtractor=c}}),montageDefine("bfd16e7","core/application",{dependencies:["core/core","core/target","window-loader/montage-window","core/dom","core/template"],factory:function(e,t){var n,i=(e("core/core").Montage,e("core/target").Target),r=e("window-loader/montage-window").MontageWindow;e("core/dom"),t.Application=i.specialize({eventManager:{value:null},parentApplication:{value:null},mainApplication:{get:function(){for(var e=this;e.parentApplication;)e=e.parentApplication;return e}},_windowsSortOrder:{value:"reverse-z-order"},windowsSortOrder:{get:function(){return null==this.parentApplication?this._windowsSortOrder:this.mainApplication.windowsSortOrder},set:function(e){null==this.parentApplication?-1!==["z-order","reverse-z-order","z-order","reverse-open-order"].indexOf(e)&&(this._windowsSortOrder=e):this.mainApplication.windowsSortOrder=e}},windows:{get:function(){var e;if(null==this.parentApplication){if(!this._windows){var e=new r;e.application=this,e.window=window,this.window=e,this._windows=[this.window],this._multipleWindow=!0}return this._windows}return this.mainApplication.windows}},_window:{value:null},window:{get:function(){if(!this._window&&this==this.mainApplication){var e=new r;e.application=this,e.window=window,this._window=e}return this._window},set:function(e){this._window||(this._window=e)}},attachedWindows:{value:[]},eventManagerForWindow:{value:function(e){return e.defaultEventMananger}},focusWindow:{get:function(){var e=this.windows,t=this.windowsSortOrder;if("z-order"==t)return e[0];if("reverse-z-order"==t)return e[e.length-1];for(var n in e)if(e[n].focused)return e[n]}},delegate:{value:null},nextTarget:{get:function(){return this.delegate}},openWindow:{value:function(e,t,n){var i,a,o=this,s=new r,l={location:!1,menubar:!1,resizable:!0,scrollbars:!0,status:!1,titlebar:!0,toolbar:!1},u={module:e,name:t,parent:window,callback:function(e,t){var n;i=e.document.application,s.window=e,s.application=i,s.component=t,i.window=s,o.attachedWindows.push(s),n=o.mainApplication.windowsSortOrder,"z-order"==n||"reverse-open-order"==n?o.windows.unshift(s):o.windows.push(s),a=document.createEvent("CustomEvent"),a.initCustomEvent("load",!0,!0,null),s.dispatchEvent(a)}};if(this!==this.mainApplication||this._multipleWindow||this.window,"object"==typeof n){var c,h,d="",p="";for(c in n)n.hasOwnProperty(c)&&(l[c]=n[c])}var m=["name"];for(c in l)-1==m.indexOf(c)&&(h=l[c],"boolean"==typeof h?h=h?"yes":"no":(h+="",h.match(/[ ,"]/)&&(h='"'+h.replace(/"/g,'\\"')+'"')),p+=d+c+"="+h,d=",");return window.require.loadPackage({name:"montage"}).then(function(e){var t=window.open(e.location+"window-loader/index.html","_blank",p);t.loadInfo=u}).done(),s}},attachWindow:{value:function(e){var t,n=e.application.parentApplication;return n!==this&&(n&&n.detachWindow(e),e.parentApplication=this,this.attachedWindows.push(e),t=this.mainApplication.windowsSortOrder,"z-order"==t||"reverse-open-order"==t?this.windows.unshift(e):this.windows.push(e),e.focus()),e}},detachWindow:{value:function(e){var t,n,i=this.windows;return void 0===e&&(e=this.window),n=e.application.parentApplication,n==this?(t=this.attachedWindows.indexOf(e),-1!==t&&this.attachedWindows.splice(t,1),t=i.indexOf(e),-1!==t&&i.splice(t,1),e.application.parentApplication=null):n&&n.detachWindow(e),e}},constructor:{value:function(){window.loadInfo&&!this.parentApplication&&(this.parentApplication=window.loadInfo.parent.document.application)}},_load:{value:function(n,i){var r,a=this;t.application=a,e.async("ui/component").then(function(t){return r=t.__root__,r.element=document,e("core/template").instantiateDocument(window.document,n).then(function(){a.callDelegateMethod("willFinishLoading",a),r.needsDraw=!0,i&&i(a)})}).done()}},_alertPopup:{value:null,enumerable:!1},_confirmPopup:{value:null,enumerable:!1},_notifyPopup:{value:null,enumerable:!1},_zIndex:{value:null},_isSystemPopup:{value:function(e){return"alert"===e||"confirm"===e||"notify"===e}},_createPopupSlot:{value:function(e){var t=document.createElement("div");document.body.appendChild(t),t.style.zIndex=e,t.style.position="absolute";var i=new n;return i.element=t,i.attachToParentComponent(),i}},getPopupSlot:{value:function(t,i,r){var a=this;e.async("ui/slot.reel/slot").then(function(e){n=n||e.Slot,t=t||"custom";var o,s,l=a._isSystemPopup(t);if(a.popupSlots=a.popupSlots||{},l)switch(t){case"alert":o=9004;break;case"confirm":o=9003;break;case"notify":o=9002}else a._zIndex=a._zIndex?a._zIndex+1:7e3,o=a._zIndex;s=a.popupSlots[t],s||(s=a.popupSlots[t]=a._createPopupSlot(o)),l||(s.element.style.zIndex=o),s.content=i,r.call(this,s)}).done()}},returnPopupSlot:{value:function(e){var t=this;if(t.popupSlots&&t.popupSlots[e]){var n=t.popupSlots[e];n.content=null}}},_getActivePopupSlots:{value:function(){var e=[];if(this.popupSlots){var t=Object.keys(this.popupSlots);if(t&&t.length>0){var n,i=0,r=t.length;for(i=0;r>i;i++)n=this.popupSlots[t[i]],n&&null!==n.content&&e.push(n)}}return e}}})}}),montageDefine("bfd16e7","core/dom",{dependencies:["core/geometry/point"],factory:function(e,t){var n=e("core/geometry/point").Point,i=Node.prototype,r=Element.prototype;Object.defineProperty(r,"set",{value:function(e,t,n){var i,r,a,o,s,l=e.indexOf(".",n);n=n||0,r=e.substring(n,-1===l?e.length:l),-1===l?this.setAttribute(r,t):(a=e.lastIndexOf("."),"style"===r?(o=e.substring(l+1,e.length),this.style[o]=t):"classList"===r?(s=e.substring(l+1,e.length),t?this.classList.add(s):this.classList.remove(s)):(i=this.get(e.substring(0,a)))&&(i[e.substring(a+1,e.length)]=t))},enumerable:!1}),i.get=function(e){return this.getAttribute(e)||this[e]},Object.getPrototypeOf(document).addRule=function(e,t){var n,i;if(null==(n=document.styleSheets[0])){var r=document.createElement("style");r.type="text/css",document.head.appendChild(r),n=document.styleSheets[0]}else i=document.getRule(e,n);i||n.insertRule(e+" "+t,n.cssRules.length)},Object.getPrototypeOf(document).getRule=function(e,t){var n;if(t.cssRules)for(var i=0;n=t.cssRules[i];i++){if(n.name&&n.name===e)return n;if(n.selectorText===e)return n}},"undefined"!=typeof Element&&function(){var e="classList";if(!Element.prototype.hasOwnProperty(e)){var t=/^\s+|\s+$/g,n=function(e,t){e.setAttribute("class",t.join(" "))},i=function(e,t){if(""===t)throw"SYNTAX_ERR";if(/\s/.test(t))throw"INVALID_CHARACTER_ERR";return e.indexOf(t)},r=function(){var e=this,r=e.getAttribute("class")||"";return r=r.replace(t,"").split(/\s+/),{length:r.length,item:function(e){return r[e]||null},contains:function(e){return-1!==i(r,e)},add:function(t){-1===i(r,t)&&(r.push(t),this.length=r.length,n(e,r))},remove:function(t){var a=i(r,t);-1!==a&&(r.splice(a,1),this.length=r.length,n(e,r))},toggle:function(e){-1===i(r,e)?this.add(e):this.remove(e)},toString:function(){return e.getAttribute("class")||""}}};Object.defineProperty?Object.defineProperty(Element.prototype,e,{get:r,enumerable:!0}):Object.prototype.__defineGetter__&&Element.prototype.__defineGetter__(e,r)}}(),i.parentOf=function(e){for(;(e=e.parentNode)&&e!==this;);return e?!0:!1};var a=function(e){var t,n,i,r,a=e.ownerDocument;if(e&&a){if(n=a.documentElement,i=a.body,r=a.defaultView,e!==i){if(t=e.getBoundingClientRect(),n.parentOf(e)){var o=n.clientTop||i.clientTop||0,s=n.clientLeft||i.clientLeft||0,l=r.pageYOffset||n.scrollTop||i.scrollTop,u=r.pageXOffset||n.scrollLeft||i.scrollLeft,c=t.top+l-o,h=t.left+u-s;return{top:c,left:h}}return{top:t.top,left:t.left}}return{top:i.offsetTop,left:i.offsetLeft}}return null},o=null;try{o=new WebKitPoint(0,0)}catch(s){}var l=function(){t.convertPointFromNodeToPage=function(e,t){return t?(o.x=t.x,o.y=t.y):(o.x=0,o.y=0),t=webkitConvertPointFromNodeToPage(e,o),t?(new n).init(t.x,t.y):null},t.convertPointFromPageToNode=function(e,t){return t?(o.x=t.x,o.y=t.y):(o.x=0,o.y=0),t=webkitConvertPointFromPageToNode(e,o),t?(new n).init(t.x,t.y):null}},u=function(){t.convertPointFromNodeToPage=function(e,t){if(!e||void 0!==e.x)return null;var i;return(i=a(e))?(new n).init((t?t.x:0)+i.left,(t?t.y:0)+i.top):(new n).init(t?t.x:0,t?t.y:0)},t.convertPointFromPageToNode=function(e,t){if(!e||void 0!==e.x)return null;var i;return(i=a(e))?(new n).init((t?t.x:0)-i.left,(t?t.y:0)-i.top):(new n).init(t?t.x:0,t?t.y:0)}};o?l():u()}}),montageDefine("bfd16e7","core/document-resources",{dependencies:["montage","core/promise","core/mini-url"],factory:function(e,t){var n=e("montage").Montage,i=e("core/promise").Promise,r=e("core/mini-url"),a=n.specialize({_SCRIPT_TIMEOUT:{value:5e3},_document:{value:null},_resources:{value:null},_preloaded:{value:null},_expectedStyles:{value:null},constructor:{value:function a(){this.super(),this._expectedStyles=[]
}},initWithDocument:{value:function(e){return this.clear(),this._document=e,this}},clear:{value:function(){this._resources=Object.create(null),this._preloaded=Object.create(null)}},_addResource:{value:function(e){this._resources[e]=!0}},hasResource:{value:function(e){return e in this._resources}},isResourcePreloaded:{value:function(e){return this._preloaded[e]===!0}},isResourcePreloading:{value:function(e){return i.isPromise(this._preloaded[e])}},setResourcePreloadedPromise:{value:function(e,t){this._preloaded[e]=t}},setResourcePreloaded:{value:function(e){this._preloaded[e]=!0}},getResourcePreloadedPromise:{value:function(e){return this._preloaded[e]}},addScript:{value:function(e){var t=this.normalizeUrl(e.src);return t?this.isResourcePreloaded(t)?i.resolve():this.isResourcePreloading(t)?this.getResourcePreloadedPromise(t):this._importScript(e):this._importScript(e)}},_importScript:{value:function(e){var t,n,r=this,a=this._document,o=a.head,s=i.defer(),l=e.src;return l?(r._addResource(l),t=function(){r.setResourcePreloaded(l),e.removeEventListener("load",t),e.removeEventListener("error",t),clearTimeout(n),s.resolve()},e.addEventListener("load",t,!1),e.addEventListener("error",t,!1),n=setTimeout(function(){r.setResourcePreloaded(l),s.resolve()},this._SCRIPT_TIMEOUT),this.setResourcePreloadedPromise(l,s.promise)):s.resolve(),o.appendChild(a.createComment("Inserted from FIXME")),o.appendChild(e),s.promise}},addStyle:{value:function(e){var t,n=e.getAttribute("href");if(n=this.normalizeUrl(n)){if(this.hasResource(n))return;this._addResource(n)}t=this._document.head,this._expectedStyles.push(n),t.insertBefore(e,t.firstChild)}},normalizeUrl:{value:function(e,t){return t||(t=this._document.location.href),r.resolve(t,e)}},preloadResource:{value:function(e){return e=this.normalizeUrl(e),this.isResourcePreloaded(e)?i.resolve():this.isResourcePreloading(e)?this.getResourcePreloadedPromise(e):this._preloadResource(e)}},_preloadResource:{value:function(e){var t,n,r=this,a=new XMLHttpRequest,o=i.defer();return a.open("GET",e),t=function(){r.setResourcePreloaded(e),a.removeEventListener("load",t),a.removeEventListener("error",t),clearTimeout(n),o.resolve()},a.addEventListener("load",t,!1),a.addEventListener("error",t,!1),a.send(),n=setTimeout(function(){r.setResourcePreloaded(e),o.resolve()},this._SCRIPT_TIMEOUT),this.setResourcePreloadedPromise(e,o.promise),o.promise}},areStylesLoaded:{get:function(){var e,t;if(this._expectedStyles.length>0){e=this._document.styleSheets;for(var n,i=0;n=e[i];i++)t=this._expectedStyles.indexOf(n.href),t>=0&&this._expectedStyles.splice(t,1)}return 0===this._expectedStyles.length}}},{getInstanceForDocument:{value:function(e){var t=e.__montage_resources__;return t||(t=e.__montage_resources__=(new a).initWithDocument(e)),t}}});t.DocumentResources=a}}),montageDefine("bfd16e7","window-loader/montage-window",{dependencies:["montage"],factory:function(e,t){var n=e("montage").Montage;t.MontageWindow=n.specialize({_application:{value:null},application:{get:function(){return this._application},set:function(e){null===this._application&&(this._application=e,this.focused&&this._setFocusedWindow(this))}},_window:{value:null},window:{get:function(){return this._window},set:function(e){if(null===this._window){var t=e.document.body;this._window=e,e.addEventListener("beforeunload",this,!0),e.addEventListener("focus",this,!0),e.addEventListener("mousedown",this,!0),null===t.getAttribute("tabIndex")&&(t.setAttribute("tabIndex",-1),t.focus())}}},document:{get:function(){return this._window.document}},_component:{value:null},component:{get:function(){return this._component},set:function(e){null===this._component&&(this._component=e)}},title:{get:function(){return this.document.title},set:function(e){this.document.title=e}},focused:{value:!1},focus:{value:function(){this._window&&this._window.focus()}},_setFocusedWindow:{value:function(e){var t,n,i,r=this.application;if(r._multipleWindow){t=r.windows;for(i in t)n=t[i],n.window===e?n.focused!==!0&&(n.focused=!0,"z-order"==r.windowsSortOrder?(t.splice(i,1),t.unshift(n)):"reverse-z-order"==r.windowsSortOrder&&(t.splice(i,1),t.push(n))):n.focused=!1}else this.focused=!0}},closed:{get:function(){return this._window?this._window.closed:!1}},close:{value:function(){this._window&&this._window.close()}},resizeTo:{value:function(e,t){this._window&&this._window.resizeTo(e,t)}},moveTo:{value:function(e,t){this._window&&this._window.moveTo(e,t)}},captureFocus:{value:function(e){var t=this.application;if(!this.application)return this.focused=!0,void 0;if(t.parentApplication)t.mainApplication.window.captureFocus(e);else{var n=(e.target.ownerDocument?e.target.ownerDocument.defaultView:null)||e.target.defaultView||e.target;this._setFocusedWindow(n)}}},captureMousedown:{value:function(e){this.captureFocus(e)}},captureBeforeunload:{value:function(){var e,t=this.application,n=t.windows,i=t.attachedWindows;t.attachedWindows=[];for(var e in i)i[e].close();t.parentApplication&&(i=t.parentApplication.attachedWindows,e=i.indexOf(this),-1!==e&&i.splice(e,1),e=n.indexOf(this),-1!==e&&n.splice(e,1),this.window.removeEventListener("beforeunload",this,!0),this.close())}}})}}),montageDefine("bfd16e7","core/gate",{dependencies:["montage","core/logger"],factory:function(e,t){var n=e("montage").Montage,i=e("core/logger").logger("gate");t.Gate=n.specialize({constructor:{value:function(){this.super()}},init:{enumerable:!1,value:function(){return this.reset(),this}},initWithDelegate:{enumerable:!1,value:function(e){return this.reset(),this.delegate=e,this}},initWithDescriptor:{enumerable:!1,value:function(e){var t;this.reset();for(t in e)this.setField(t,e[t].value);return this}},count:{value:0},table:{value:null},getField:{enumerable:!1,value:function(e){var t=this.table;return!t||t[e]}},setField:{enumerable:!1,value:function(e,t){var n,r=this.table,a=this.count;r=r?r:this.table={},n=r[e],void 0!==n||t?void 0!==n&&n!==t?t?this.count--:this.count++:t&&i.isDebug&&i.debug(this,e+" was not set before."):this.count++,r[e]=!!t,0===this.count&&a>0?this.callDelegateMethod(!0):0===a&&this.count>0&&this.callDelegateMethod(!1)}},removeField:{enumerable:!1,value:function(e){var t=this.table,n=t[e];void 0===n||n||this.count--,delete t[e]}},delegate:{enumerable:!1,value:null},callDelegateMethod:{value:function(e){var t;this.delegate&&"function"==typeof(t=this.delegate["gateDidBecome"+(e?"True":"False")])&&t.call(this.delegate,this)},enumerable:!1},value:{enumerable:!1,get:function(){return 0===this.count}},reset:{enumerable:!1,value:function(){this.table={},this.count=0}},toString:{value:function(){var e,t,n=this._fields,i="";for(e=0;t=n[e];e++)i+=t+"["+(this._value&n[t])+"], ";return i}}})}}),montageDefine("bfd16e7","core/document-part",{dependencies:["montage","core/logger","core/promise","core/event/event-manager"],factory:function(e,t){var n=e("montage").Montage,i=(e("core/logger").logger("document-part"),e("core/promise").Promise),r=e("core/event/event-manager").defaultEventManager,a=n.specialize({template:{value:null},fragment:{value:null},objects:{value:null},childComponents:{value:null},parameters:{value:null},constructor:{value:function a(){this.super()}},initWithTemplateAndFragment:{value:function(e,t){this.template=e,this.fragment=t,this.objects=null,this.childComponents=[],this.parameters=null}},startActingAsTopComponent:{value:function(){this.fragment&&r.registerEventHandlerForElement(this,this.fragment)}},stopActingAsTopComponent:{value:function(){this.fragment&&r.unregisterEventHandlerForElement(this.fragment)}},addChildComponent:{value:function(e){-1==this.childComponents.indexOf(e)&&this.childComponents.push(e)}},removeChildComponent:{value:function(e){var t=this.childComponents,n=t.indexOf(e);n>-1&&(t.splice(n,1),e._parentComponent=null,e._alternateParentComponent=null)}},_addToDrawList:{value:function(){}},_componentTreeLoadedDeferred:{value:null},loadComponentTree:{value:function(){var e,t=this._componentTreeLoadedDeferred;return t||(t=i.defer(),this._componentTreeLoadedDeferred=t,e=[],this.childComponents.forEach(function(t){e.push(t.loadComponentTree())}),i.all(e).then(function(){t.resolve()},t.reject).done()),t.promise}}});t.DocumentPart=a}}),montageDefine("bfd16e7","core/target",{dependencies:["montage","core/event/event-manager","core/event/mutable-event"],factory:function(e,t){var n=e("montage").Montage,i=e("core/event/event-manager").defaultEventManager,r=e("core/event/mutable-event").MutableEvent;t.Target=n.specialize({constructor:{value:function(){this.super()}},acceptsActiveTarget:{serializable:!1,value:!1},isActiveTarget:{get:function(){return this===i.activeTarget}},willBecomeActiveTarget:{value:Function.noop},didBecomeActiveTarget:{value:Function.noop},surrendersActiveTarget:{value:function(){return!0}},nextTarget:{serializable:!1,value:null},dispatchEvent:{value:function(e){var t=e;e instanceof r||(t=r.fromEvent(t)),t.target=this,i.handleEvent(t)}},dispatchEventNamed:{value:function(e,t,n,a){var o=r.fromType(e,t,n,a);o.target=this,i.handleEvent(o)}},addEventListener:{value:function(e,t,n){t&&i.registerEventListener(this,e,t,n)}},removeEventListener:{value:function(e,t,n){t&&i.unregisterEventListener(this,e,t,n)}}})}}),montageDefine("f4ac656","ui/fallback.reel/fallback",{dependencies:["montage/ui/component"],factory:function(e,t){var n;n=e("montage/ui/component").Component,t.Fallback=n.specialize({_supportsWebGL:{value:null},supportsWebGL:{get:function(){if(null===this._supportsWebGL){var e={premultipliedAlpha:!1,antialias:!0,preserveDrawingBuffer:!1},t=document.createElement("canvas"),n=t.getContext("experimental-webgl",e)||t.getContext("webgl",e);this._supportsWebGL=!!n}return this._supportsWebGL}},viewKey:{value:null},templateDidLoad:{value:function(){this.viewKey=this.supportsWebGL?"webgl":"static"}}})}}),montageDefine("bfd16e7","core/geometry/point",{dependencies:["montage"],factory:function(e,t){var n=e("montage").Montage;t.Point=n.specialize({init:{enumerable:!1,value:function(e,t){return this.x=null===e?0:e,this.y=null===t?0:t,this}},x:{enumerable:!0,value:0},y:{enumerable:!0,value:0}},{interpolate:{enumerable:!1,value:function(e,n,i,r){var a,o;return a=n.x+(i.x-n.x)*e,o=n.y+(i.y-n.y)*e,r>0&&(a=Math.round(a*r)/r,o=Math.round(o*r)/r),(new t.Point).init(a,o)}}})}});
bundleLoaded("buoy.html.bundle-1-0.js")