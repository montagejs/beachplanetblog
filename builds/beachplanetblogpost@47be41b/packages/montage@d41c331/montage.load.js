montageDefine("d41c331","montage",{dependencies:["./node.js"],factory:function(e,t,n){"undefined"!=typeof window&&(document._montageTiming={},document._montageTiming.loadStartTime=Date.now(),window.addEventListener("DOMContentLoaded",function(){var e=1e3;document._montageStartBootstrappingTimeout=setTimeout(function(){document._montageStartBootstrappingTimeout=null;var e=document.documentElement;e.classList?e.classList.add("montage-app-bootstrapping"):e.className=e.className+" montage-app-bootstrapping",document._montageTiming.bootstrappingStartTime=Date.now()},e)})),function(i){e!==void 0?i.call("undefined"!=typeof global?global:this,e,t,n):i({},{},{})}(function(e,t){global=this,t.initMontage=function(){var e=t.getPlatform();e.bootstrap(function(n,i,r){var a=e.getParams(),o={location:n.getLocation()},l=r.resolve(o.location,a.montageLocation);o.moduleTypes=["html","meta"],o.makeLoader=function(e){return t.ReelLoader(e,n.makeLoader(e))},o.makeCompiler=function(e){return t.MetaCompiler(e,t.SerializationCompiler(e,t.TemplateCompiler(e,n.makeCompiler(e))))};var c=r.resolve(o.location,a["package"]||"."),u=a.applicationHash;if("object"==typeof BUNDLE){var h={},d=function(e){return h[e]=h[e]||i.defer()};global.bundleLoaded=function(e){d(e).resolve()};var p=i.defer();o.preloaded=p.promise;var m=i.resolve();BUNDLE.forEach(function(e){m=m.then(function(){return i.all(e.map(function(e){return s.load(e),d(e).promise}))})}),p.resolve(m.then(function(){delete BUNDLE,delete bundleLoaded}))}var f;if("remoteTrigger"in a){var g=i.defer();window.postMessage({type:"montageReady"},"*");var v=function(e){if(a.remoteTrigger===e.origin&&(e.source===window||e.source===window.parent))switch(e.data.type){case"montageInit":window.removeEventListener("message",v),g.resolve([e.data.location,e.data.injections]);break;case"isMontageReady":window.postMessage({type:"montageReady"},"*")}};window.addEventListener("message",v),f=g.promise.spread(function(e,t){var i=n.loadPackage({location:e,hash:u},o);return t&&(i=i.then(function(n){e=r.resolve(e,".");var i,a,s=t.packageDescriptions,o=t.packageDescriptionLocations,l=t.mappings,c=t.dependencies;if(s)for(a=s.length,i=0;a>i;i++)n.injectPackageDescription(s[i].location,s[i].description);if(o)for(a=o.length,i=0;a>i;i++)n.injectPackageDescriptionLocation(o[i].location,o[i].descriptionLocation);if(l)for(a=l.length,i=0;a>i;i++)n.injectMapping(l[i].dependency,l[i].name);if(c)for(a=c.length,i=0;a>i;i++)n.injectDependency(c[i].name,c[i].version);return n})),i})}else{if("autoPackage"in a)n.injectPackageDescription(c,{dependencies:{montage:"*"}},o);else if(".json"===c.slice(c.length-5)){var _=c;c=r.resolve(c,"."),n.injectPackageDescriptionLocation(c,_,o)}f=n.loadPackage({location:c,hash:u},o)}f.then(function(t){t.loadPackage({location:l,hash:a.montageHash}).then(function(e){var t;return t=a.promiseLocation?r.resolve(n.getLocation(),a.promiseLocation):r.resolve(l,"packages/mr/packages/q"),[e,e.loadPackage({location:t,hash:a.promiseHash})]}).spread(function(n,s){n.inject("core/mini-url",r),n.inject("core/promise",{Promise:i}),s.inject("q",i),o.lint=function(e){n.async("core/jshint").then(function(t){t.JSHINT(e.text)||(console.warn("JSHint Error: "+e.location),t.JSHINT.errors.forEach(function(e){e&&(console.warn("Problem at line "+e.line+" character "+e.character+": "+e.reason),e.evidence&&console.warn("    "+e.evidence))}))}).done()},self.require=self.mr=t,e.initMontage(n,t,a)})}).done()})};var n=/((.*)\.reel)\/\2$/,i=function(e,t){return t};t.SerializationCompiler=function(e,t){return function(e){if(t(e),e.factory){var r=e.factory;return e.factory=function(e,t,a){r.call(this,e,t,a);for(var s in t){var o=t[s];if(o instanceof Object){if(o.hasOwnProperty("_montage_metadata")&&!o._montage_metadata.isInstance)o._montage_metadata.aliases.push(s),o._montage_metadata.objectName=s;else if(!Object.isSealed(o)){var l=a.id.replace(n,i);Object.defineProperty(o,"_montage_metadata",{value:{require:e,module:l,moduleId:l,property:s,objectName:s,aliases:[s],isInstance:!1}})}}else;}},e}}};var r=/([^\/]+)\.reel$/;t.ReelLoader=function(e,t){return function(e,n){var i=r.exec(e);return i?(n.redirect=e+"/"+i[1],n):t(e,n)}};var a=/\.meta/;t.MetaCompiler=function(e,t){return function(e){var n=(e.location||"").match(a);return n?(e.exports=JSON.parse(e.text),e):t(e)}},t.TemplateCompiler=function(e,t){return function(e){if(e.location){var n=e.location.match(/(.*\/)?(?=[^\/]+\.html(?:\.load\.js)?$)/);return n?(e.dependencies=e.dependencies||[],e.exports={directory:n[1],content:e.text},Object.defineProperty(e.exports,"root",{get:function(){return"object"==typeof console&&console.warn("'root' property is deprecated on template modules.  Use 'directory' instead of root[1]"),n}}),e):(t(e),void 0)}}},t.getPlatform=function(){if("undefined"!=typeof window&&window&&window.document)return s;if("undefined"!=typeof process)return e("./node.js");throw Error("Platform not supported.")};var s={makeResolve:function(){var e=document.querySelector("head"),t=document.createElement("base"),n=document.createElement("a");return t.href="",function(i,r){var a=e.querySelector("base");if(a||(e.appendChild(t),a=t),i+="",!/^[\w\-]+:/.test(i))throw Error("Can't resolve from a relative location: "+JSON.stringify(i)+" "+JSON.stringify(r));var s=a.href;a.href=i,n.href=r;var o=n.href;return a.href=s,a===t&&e.removeChild(a),o}},load:function(e){var t=document.createElement("script");t.src=e,t.onload=function(){t.parentNode.removeChild(t)},document.getElementsByTagName("head")[0].appendChild(t)},getParams:function(){var e,t,n,i,r,a,s;if(!this._params){this._params={};var o=document.getElementsByTagName("script");for(e=0;o.length>e;e++)if(i=o[e],r=!1,i.src&&(n=i.src.match(/^(.*)montage.js(?:[\?\.]|$)/i))&&(this._params.montageLocation=n[1],r=!0),i.hasAttribute("data-montage-location")&&(this._params.montageLocation=i.getAttribute("data-montage-location"),r=!0),r){if(i.dataset)for(s in i.dataset)this._params[s]=i.dataset[s];else if(i.attributes){var l=/-([a-z])/g,c=function(e,t){return t.toUpperCase()};for(t=0;i.attributes.length>t;t++)a=i.attributes[t],n=a.name.match(/^data-(.*)$/),n&&(this._params[n[1].replace(l,c)]=a.value)}i.parentNode.removeChild(i);break}}return this._params},bootstrap:function(e){function t(){document.removeEventListener("DOMContentLoaded",t,!0),o=!0,r()}function n(e){if(!g[e]&&f[e]){var t=g[e]={};g[e]=f[e](n,t)||t}return g[e]}function i(){c=n("mini-url"),l=n("promise"),a=n("require"),delete global.bootstrap,r()}function r(){o&&a&&e(a,l,c)}var a,o,l,c,u=this.getParams(),h=this.makeResolve();/interactive|complete/.test(document.readyState)?t():document.addEventListener("DOMContentLoaded",t,!0);var d={require:"packages/mr/require.js","require/browser":"packages/mr/browser.js",promise:"packages/mr/packages/q/q.js"};if("undefined"==typeof BUNDLE){var p=h(window.location,u.montageLocation);for(var m in d)s.load(h(p,d[m]))}var f={};global.bootstrap=function(e,t){f[e]=t,delete d[e];for(var e in d)return;delete global.bootstrap,i()},global.bootstrap("mini-url",function(e,t){t.resolve=h});var g={}},initMontage:function(e,t,n){var i=["core/core","core/event/event-manager","core/serialization/deserializer/montage-reviver","core/logger","core/deprecate"],r=e("core/promise").Promise;return r.all(i.map(e.deepLoad)).then(function(){i.forEach(e),e("core/core").Montage;var a,s,o=e("core/event/event-manager").EventManager,l=e("core/serialization/deserializer/montage-reviver").MontageReviver,c=e("core/logger").logger,u=e("core/deprecate");c("Promise stacktrace support",function(e){r.longStackSupport=!!e}),a=(new o).initWithWindow(window),"function"==typeof global.montageWillLoad&&global.montageWillLoad();var h,d,p=t.packageDescription.applicationPrototype;return p?(h=l.parseObjectLocationId(p),d=t.async(h.moduleId)):d=e.async("core/application"),d.then(function(e){var i=e[h?h.objectName:"Application"];s=new i,Object.defineProperty(window.document,"application",{get:u.deprecateMethod(null,function(){return e.application},'document.application is deprecated, use require("montage/core/application").application instead.')}),a.application=s,s.eventManager=a,s._load(t,function(){n.module&&t.async(n.module).done(),"function"==typeof global.montageDidLoad&&global.montageDidLoad()})})}).done()}};"undefined"!=typeof window?global.__MONTAGE_LOADED__?console.warn("Montage already loaded!"):(global.__MONTAGE_LOADED__=!0,t.initMontage()):t.getPlatform()})}});