montageDefine("748f581","buffer-stream",{dependencies:["q","./reader"],factory:function(e,t,n){function i(e,t){return this instanceof i?(e?Array.isArray(e)||(e=[e]):e=[],this._charset=t,this._chunks=e,this._close=r.defer(),this.closed=this._close.promise,void 0):new i(e,t)}var r=e("q"),a=e("./reader");n.exports=i,i.prototype.forEach=function(e,t){var n=this,i=n._chunks;return r.fcall(function(){i.splice(0,i.length).forEach(e,t)})},i.prototype.read=function(){var e;return e=a.join(this._chunks),this._charset&&(e=e.toString(this._charset)),r.resolve(e)},i.prototype.write=function(e){if(this._charset)e=new Buffer(e+"",this._charset);else if(!(e instanceof Buffer))throw Error("Can't write strings to buffer stream without a charset: "+e);return this._chunks.push(e),r.resolve()},i.prototype.close=function(){return this._close.resolve(),r.resolve()},i.prototype.destroy=function(){return this._close.resolve(),r.resolve()}}});