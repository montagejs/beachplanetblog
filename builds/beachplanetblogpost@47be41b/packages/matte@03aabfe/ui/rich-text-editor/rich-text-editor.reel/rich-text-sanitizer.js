var Montage=require("montage").Montage;exports.Sanitizer=Montage.specialize({willSetValue:{value:function(e,t){return this._scopeCSS(e,t)}},didGetValue:{value:function(e,t){return this._unscopeCSS(e,t)}},willInsertHtmlData:{value:function(e,t){return this._scopeCSS(this._removeScript(e),t)}},_scopeCSS:{enumerable:!0,value:function(e,t){var i=".editor-"+t+" ";return"string"==typeof e&&(e=e.replace(/(<style ?[^>]*>)([^<]*)(<\/style>)/gi,function(e,t,n,a){return n=n.replace(/\t|\n|\r/g,function(e){return"	"==e?" ":""}),n=n.replace(/\*\.editor-[^ ] +/g,"body"),n=n.replace(/\.editor-[^ ]+ /g,""),n=n.replace(/([^{]+)({[^}]*})/gi,function(e,t,n){return t=t.replace(/ *([^,]+)/g,function(e,t){return"body"==t.toLowerCase()?"*"+i:i+t}),t+n}),t+n+a})),e}},_unscopeCSS:{enumerable:!0,value:function(e){return"string"==typeof e&&(e=e.replace(/(<style ?[^>]*>)([^<]*)(<\/style>)/gi,function(e,t,i,n){return i=i.replace(/\*\.editor-[^ ] +/g,"body"),i=i.replace(/\.editor-[^ ]+ /g,""),t+i+n})),e}},_removeScript:{enumerable:!0,value:function(e){var t=document.createElement("div"),i=function(e){var t,n,a,s=e.children,o=s.length,r=e.attributes,l=r.length;for(a=0;l>a;a++)n=r[a],(n.name.match(/^on[a-z]+/i)||n.value.match(/^javascript:/))&&(e.removeAttribute(n.name),a--,l--);for(a=0;o>a;a++)t=s[a],"SCRIPT"==t.tagName?(t.parentNode.removeChild(t),a--,o--):i(t)};return t.innerHTML=e,i(t),t.innerHTML}}});